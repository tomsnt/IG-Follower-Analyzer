<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instagram Analyzer - Web Version</title>
    <link rel="manifest" href="manifest.json">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(45deg, #f09433 0%,#e6683c 25%,#dc2743 50%,#cc2366 75%,#bc1888 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .tabs {
            display: flex;
            border-bottom: 1px solid #eee;
        }
        
        .tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .tab.active {
            background: #667eea;
            color: white;
        }
        
        .tab-content {
            display: none;
            padding: 30px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .drop-zone {
            border: 2px dashed #ccc;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            margin: 20px 0;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .drop-zone.dragover {
            border-color: #667eea;
            background: #f8f9ff;
        }
        
        .results {
            margin-top: 30px;
        }
        
        .stat-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin: 10px 0;
            border-left: 4px solid #667eea;
        }
        
        .user-list {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #eee;
            border-radius: 10px;
            margin-top: 20px;
        }
        
        .user-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #eee;
            transition: background 0.2s;
        }
        
        .user-item:hover {
            background: #f8f9fa;
        }
        
        .user-item:last-child {
            border-bottom: none;
        }
        
        .user-link {
            color: #667eea;
            text-decoration: none;
            font-weight: 500;
        }
        
        .user-link:hover {
            text-decoration: underline;
        }
        
        .install-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #667eea;
            color: white;
            border: none;
            padding: 15px 20px;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
            display: none;
        }
        
        @media (max-width: 768px) {
            .tabs {
                flex-direction: column;
            }
            
            .container {
                margin: 0;
                border-radius: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸ“± Instagram Analyzer</h1>
            <p>Analizza i tuoi followers e following di Instagram</p>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="showTab('upload')">ðŸ“‚ Upload File</button>
            <button class="tab" onclick="showTab('analysis')">ðŸ“Š Analisi Follow</button>
            <button class="tab" onclick="showTab('comparison')">ðŸ“ˆ Confronto</button>
        </div>
        
        <div id="upload" class="tab-content active">
            <h2>Carica i tuoi file Instagram</h2>
            
            <div class="drop-zone" id="followersDropZone">
                <h3>ðŸ“¥ File Followers</h3>
                <p>Trascina qui il file followers_1.html o clicca per selezionare</p>
                <input type="file" id="followersFile" accept=".html" style="display: none;">
            </div>
            
            <div class="drop-zone" id="followingDropZone">
                <h3>ðŸ“¤ File Following</h3>
                <p>Trascina qui il file following.html o clicca per selezionare</p>
                <input type="file" id="followingFile" accept=".html" style="display: none;">
            </div>
            
            <div id="uploadStatus"></div>
        </div>
        
        <div id="analysis" class="tab-content">
            <h2>Analisi Follow/Following</h2>
            <div id="analysisResults">
                <p>Carica prima i file nella sezione Upload per vedere l'analisi.</p>
            </div>
        </div>
        
        <div id="comparison" class="tab-content">
            <h2>Confronto Temporale</h2>
            <div id="comparisonResults">
                <p>FunzionalitÃ  disponibile dopo il caricamento dei file.</p>
            </div>
        </div>
    </div>
    
    <button class="install-button" id="installButton" onclick="installApp()">
        ðŸ“± Installa App
    </button>
    
    <script>
        // Global variables
        let followers = [];
        let following = [];
        let deferredPrompt;
        
        // PWA Installation
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('installButton').style.display = 'block';
        });
        
        function installApp() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('App installata!');
                    }
                    deferredPrompt = null;
                });
            }
        }
        
        // Tab Management
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }
        
        // File Upload Setup
        function setupDropZone(dropZoneId, fileInputId, callback) {
            const dropZone = document.getElementById(dropZoneId);
            const fileInput = document.getElementById(fileInputId);
            
            dropZone.addEventListener('click', () => fileInput.click());
            
            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropZone.classList.add('dragover');
            });
            
            dropZone.addEventListener('dragleave', () => {
                dropZone.classList.remove('dragover');
            });
            
            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.classList.remove('dragover');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleFile(files[0], callback);
                }
            });
            
            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    handleFile(e.target.files[0], callback);
                }
            });
        }
        
        // File Processing
        function handleFile(file, callback) {
            const reader = new FileReader();
            reader.onload = (e) => {
                const content = e.target.result;
                const users = parseInstagramHTML(content);
                callback(users);
                updateStatus(`âœ… File caricato: ${users.length} utenti trovati`);
                updateAnalysis();
            };
            reader.readAsText(file);
        }
        
        // HTML Parsing (same logic as Swift app)
        function parseInstagramHTML(html) {
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            const links = doc.querySelectorAll('a[href*="instagram.com/"]');
            
            const users = [];
            links.forEach(link => {
                const href = link.href;
                const username = href.split('instagram.com/')[1]?.split('/')[0];
                const displayName = link.textContent.trim();
                
                if (username && username !== 'p' && !username.includes('?')) {
                    users.push({
                        username: username,
                        displayName: displayName,
                        profileUrl: `https://www.instagram.com/${username}`
                    });
                }
            });
            
            // Remove duplicates
            const unique = users.filter((user, index, self) => 
                index === self.findIndex(u => u.username === user.username)
            );
            
            return unique;
        }
        
        // Analysis Functions
        function updateAnalysis() {
            if (followers.length === 0 || following.length === 0) return;
            
            const followersUsernames = new Set(followers.map(u => u.username));
            const followingUsernames = new Set(following.map(u => u.username));
            
            const notFollowingBack = following.filter(u => !followersUsernames.has(u.username));
            const notFollowing = followers.filter(u => !followingUsernames.has(u.username));
            const mutualFollows = following.filter(u => followersUsernames.has(u.username));
            
            const analysisResults = document.getElementById('analysisResults');
            analysisResults.innerHTML = `
                <div class="stat-card">
                    <h3>ðŸ”´ Non ti seguono indietro</h3>
                    <p><strong>${notFollowingBack.length}</strong> persone</p>
                </div>
                
                <div class="stat-card">
                    <h3>ðŸŸ  Non ricambi il follow</h3>
                    <p><strong>${notFollowing.length}</strong> persone</p>
                </div>
                
                <div class="stat-card">
                    <h3>ðŸŸ¢ Follow mutui</h3>
                    <p><strong>${mutualFollows.length}</strong> persone</p>
                </div>
                
                <h3>Non ti seguono indietro:</h3>
                ${createUserList(notFollowingBack)}
                
                <h3>Potresti seguire:</h3>
                ${createUserList(notFollowing.slice(0, 20))}
            `;
        }
        
        function createUserList(users) {
            if (users.length === 0) return '<p>Nessun utente in questa categoria.</p>';
            
            return `
                <div class="user-list">
                    ${users.map(user => `
                        <div class="user-item">
                            <a href="${user.profileUrl}" target="_blank" class="user-link">
                                @${user.username}
                            </a>
                            <span style="margin-left: 10px; color: #666;">
                                ${user.displayName}
                            </span>
                        </div>
                    `).join('')}
                </div>
            `;
        }
        
        function updateStatus(message) {
            document.getElementById('uploadStatus').innerHTML = `<p>${message}</p>`;
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            setupDropZone('followersDropZone', 'followersFile', (users) => {
                followers = users;
            });
            
            setupDropZone('followingDropZone', 'followingFile', (users) => {
                following = users;
            });
        });
    </script>
</body>
</html>